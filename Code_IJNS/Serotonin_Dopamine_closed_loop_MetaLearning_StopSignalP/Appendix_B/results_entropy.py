#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
@author: federicarobertazzi
"""
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd 

#################################################################PARTE_1#################################################################

#closed-loop dataset
entropy_vec_test_closed_loop_1=np.loadtxt('<insert txt>')
beta_new_closed_loop_1=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_2=np.loadtxt('<insert txt>')
beta_new_closed_loop_2=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_3=np.loadtxt('<insert txt>')
beta_new_closed_loop_3=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_4=np.loadtxt('<insert txt>')
beta_new_closed_loop_4=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_5=np.loadtxt('<insert txt>')
beta_new_closed_loop_5=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_6=np.loadtxt('<insert txt>')
beta_new_closed_loop_6=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_7=np.loadtxt('<insert txt>')
beta_new_closed_loop_7=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_8=np.loadtxt('<insert txt>')
beta_new_closed_loop_8=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_9=np.loadtxt('<insert txt>')
beta_new_closed_loop_9=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_10=np.loadtxt('<insert txt>')
beta_new_closed_loop_10=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_11=np.loadtxt('<insert txt>')
beta_new_closed_loop_11=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_12=np.loadtxt('<insert txt>')
beta_new_closed_loop_12=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_13=np.loadtxt('<insert txt>')
beta_new_closed_loop_13=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_14=np.loadtxt('<insert txt>')
beta_new_closed_loop_14=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_15=np.loadtxt('<insert txt>')
beta_new_closed_loop_15=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_16=np.loadtxt('<insert txt>')
beta_new_closed_loop_16=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_17=np.loadtxt('<insert txt>')
beta_new_closed_loop_17=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_18=np.loadtxt('<insert txt>')
beta_new_closed_loop_18=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_19=np.loadtxt('<insert txt>')
beta_new_closed_loop_19=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_20=np.loadtxt('<insert txt>')
beta_new_closed_loop_20=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_21=np.loadtxt('<insert txt>')
beta_new_closed_loop_21=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_22=np.loadtxt('<insert txt>')
beta_new_closed_loop_22=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_23=np.loadtxt('<insert txt>')
beta_new_closed_loop_23=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_24=np.loadtxt('<insert txt>')
beta_new_closed_loop_24=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_25=np.loadtxt('<insert txt>')
beta_new_closed_loop_25=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_26=np.loadtxt('<insert txt>')
beta_new_closed_loop_26=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_27=np.loadtxt('<insert txt>')
beta_new_closed_loop_27=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_28=np.loadtxt('<insert txt>')
beta_new_closed_loop_28=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_29=np.loadtxt('<insert txt>')
beta_new_closed_loop_29=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_30=np.loadtxt('<insert txt>')
beta_new_closed_loop_30=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_31=np.loadtxt('<insert txt>')
beta_new_closed_loop_31=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_32=np.loadtxt('<insert txt>')
beta_new_closed_loop_32=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_33=np.loadtxt('<insert txt>')
beta_new_closed_loop_33=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_34=np.loadtxt('<insert txt>')
beta_new_closed_loop_34=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_35=np.loadtxt('<insert txt>')
beta_new_closed_loop_35=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_36=np.loadtxt('<insert txt>')
beta_new_closed_loop_36=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_37=np.loadtxt('<insert txt>')
beta_new_closed_loop_37=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_38=np.loadtxt('<insert txt>')
beta_new_closed_loop_38=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_39=np.loadtxt('<insert txt>')
beta_new_closed_loop_39=np.loadtxt('<insert txt>')

entropy_vec_test_closed_loop_40=np.loadtxt('<insert txt>')
beta_new_closed_loop_40=np.loadtxt('<insert txt>')

#open-loop dataset
entropy_vec_test_open_loop_1=np.loadtxt('<insert txt>')
beta_new_open_loop_1=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_2=np.loadtxt('<insert txt>')
beta_new_open_loop_2=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_3=np.loadtxt('<insert txt>')
beta_new_open_loop_3=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_4=np.loadtxt('<insert txt>')
beta_new_open_loop_4=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_5=np.loadtxt('<insert txt>')
beta_new_open_loop_5=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_6=np.loadtxt('<insert txt>')
beta_new_open_loop_6=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_7=np.loadtxt('<insert txt>')
beta_new_open_loop_7=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_8=np.loadtxt('<insert txt>')
beta_new_open_loop_8=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_9=np.loadtxt('<insert txt>')
beta_new_open_loop_9=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_10=np.loadtxt('<insert txt>')
beta_new_open_loop_10=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_11=np.loadtxt('<insert txt>')
beta_new_open_loop_11=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_12=np.loadtxt('<insert txt>')
beta_new_open_loop_12=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_13=np.loadtxt('<insert txt>')
beta_new_open_loop_13=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_14=np.loadtxt('<insert txt>')
beta_new_open_loop_14=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_15=np.loadtxt('<insert txt>')
beta_new_open_loop_15=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_16=np.loadtxt('<insert txt>')
beta_new_open_loop_16=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_17=np.loadtxt('<insert txt>')
beta_new_open_loop_17=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_18=np.loadtxt('<insert txt>')
beta_new_open_loop_18=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_19=np.loadtxt('<insert txt>')
beta_new_open_loop_19=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_20=np.loadtxt('<insert txt>')
beta_new_open_loop_20=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_21=np.loadtxt('<insert txt>')
beta_new_open_loop_21=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_22=np.loadtxt('<insert txt>')
beta_new_open_loop_22=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_23=np.loadtxt('<insert txt>')
beta_new_open_loop_23=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_24=np.loadtxt('<insert txt>')
beta_new_open_loop_24=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_25=np.loadtxt('<insert txt>')
beta_new_open_loop_25=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_26=np.loadtxt('<insert txt>')
beta_new_open_loop_26=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_27=np.loadtxt('<insert txt>')
beta_new_open_loop_27=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_28=np.loadtxt('<insert txt>')
beta_new_open_loop_28=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_29=np.loadtxt('<insert txt>')
beta_new_open_loop_29=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_30=np.loadtxt('<insert txt>')
beta_new_open_loop_30=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_31=np.loadtxt('<insert txt>')
beta_new_open_loop_31=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_32=np.loadtxt('<insert txt>')
beta_new_open_loop_32=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_33=np.loadtxt('<insert txt>')
beta_new_open_loop_33=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_34=np.loadtxt('<insert txt>')
beta_new_open_loop_34=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_35=np.loadtxt('<insert txt>')
beta_new_open_loop_35=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_36=np.loadtxt('<insert txt>')
beta_new_open_loop_36=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_37=np.loadtxt('<insert txt>')
beta_new_open_loop_37=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_38=np.loadtxt('<insert txt>')
beta_new_open_loop_38=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_39=np.loadtxt('<insert txt>')
beta_new_open_loop_39=np.loadtxt('<insert txt>')

entropy_vec_test_open_loop_40=np.loadtxt('<insert txt>')
beta_new_open_loop_40=np.loadtxt('<insert txt>')

vec_beta_new_open_loop=[beta_new_open_loop_1,beta_new_open_loop_2,beta_new_open_loop_3,beta_new_open_loop_4,beta_new_open_loop_5,beta_new_open_loop_6,beta_new_open_loop_7,beta_new_open_loop_8,beta_new_open_loop_9,beta_new_open_loop_10,
                        beta_new_open_loop_11,beta_new_open_loop_12,beta_new_open_loop_13,beta_new_open_loop_14,beta_new_open_loop_15,beta_new_open_loop_16,beta_new_open_loop_17,beta_new_open_loop_18,beta_new_open_loop_19,beta_new_open_loop_20,
                        beta_new_open_loop_21,beta_new_open_loop_22,beta_new_open_loop_23,beta_new_open_loop_24,beta_new_open_loop_25,beta_new_open_loop_26,beta_new_open_loop_27,beta_new_open_loop_28,beta_new_open_loop_29,beta_new_open_loop_30,
                        beta_new_open_loop_31,beta_new_open_loop_32,beta_new_open_loop_33,beta_new_open_loop_34,beta_new_open_loop_35,beta_new_open_loop_36,beta_new_open_loop_37,beta_new_open_loop_38,beta_new_open_loop_39,beta_new_open_loop_40]

vec_entropy_vec_test_open_loop=[entropy_vec_test_open_loop_1,entropy_vec_test_open_loop_2,entropy_vec_test_open_loop_3,entropy_vec_test_open_loop_4,entropy_vec_test_open_loop_5,entropy_vec_test_open_loop_6,entropy_vec_test_open_loop_7,entropy_vec_test_open_loop_8,entropy_vec_test_open_loop_9,entropy_vec_test_open_loop_10,
                                  entropy_vec_test_open_loop_11,entropy_vec_test_open_loop_12,entropy_vec_test_open_loop_13,entropy_vec_test_open_loop_14,entropy_vec_test_open_loop_15,entropy_vec_test_open_loop_16,entropy_vec_test_open_loop_17,entropy_vec_test_open_loop_18,entropy_vec_test_open_loop_19,entropy_vec_test_open_loop_20,
                                  entropy_vec_test_open_loop_21,entropy_vec_test_open_loop_22,entropy_vec_test_open_loop_23,entropy_vec_test_open_loop_24,entropy_vec_test_open_loop_25,entropy_vec_test_open_loop_26,entropy_vec_test_open_loop_27,entropy_vec_test_open_loop_28,entropy_vec_test_open_loop_29,entropy_vec_test_open_loop_30,
                                  entropy_vec_test_open_loop_31,entropy_vec_test_open_loop_32,entropy_vec_test_open_loop_33,entropy_vec_test_open_loop_34,entropy_vec_test_open_loop_35,entropy_vec_test_open_loop_36,entropy_vec_test_open_loop_37,entropy_vec_test_open_loop_38,entropy_vec_test_open_loop_39,entropy_vec_test_open_loop_40]

vec_beta_new_closed_loop=[beta_new_closed_loop_1,beta_new_closed_loop_2,beta_new_closed_loop_3,beta_new_closed_loop_4,beta_new_closed_loop_5,beta_new_closed_loop_6,beta_new_closed_loop_7,beta_new_closed_loop_8,beta_new_closed_loop_9,beta_new_closed_loop_10,
                        beta_new_closed_loop_11,beta_new_closed_loop_12,beta_new_closed_loop_13,beta_new_closed_loop_14,beta_new_closed_loop_15,beta_new_closed_loop_16,beta_new_closed_loop_17,beta_new_closed_loop_18,beta_new_closed_loop_19,beta_new_closed_loop_20,
                        beta_new_closed_loop_21,beta_new_closed_loop_22,beta_new_closed_loop_23,beta_new_closed_loop_24,beta_new_closed_loop_25,beta_new_closed_loop_26,beta_new_closed_loop_27,beta_new_closed_loop_28,beta_new_closed_loop_29,beta_new_closed_loop_30,
                        beta_new_closed_loop_31,beta_new_closed_loop_32,beta_new_closed_loop_33,beta_new_closed_loop_34,beta_new_closed_loop_35,beta_new_closed_loop_36,beta_new_closed_loop_37,beta_new_closed_loop_38,beta_new_closed_loop_39,beta_new_closed_loop_40]

vec_entropy_vec_test_closed_loop=[entropy_vec_test_closed_loop_1,entropy_vec_test_closed_loop_2,entropy_vec_test_closed_loop_3,entropy_vec_test_closed_loop_4,entropy_vec_test_closed_loop_5,entropy_vec_test_closed_loop_6,entropy_vec_test_closed_loop_7,entropy_vec_test_closed_loop_8,entropy_vec_test_closed_loop_9,entropy_vec_test_closed_loop_10,
                                  entropy_vec_test_closed_loop_11,entropy_vec_test_closed_loop_12,entropy_vec_test_closed_loop_13,entropy_vec_test_closed_loop_14,entropy_vec_test_closed_loop_15,entropy_vec_test_closed_loop_16,entropy_vec_test_closed_loop_17,entropy_vec_test_closed_loop_18,entropy_vec_test_closed_loop_19,entropy_vec_test_closed_loop_20,
                                  entropy_vec_test_closed_loop_21,entropy_vec_test_closed_loop_22,entropy_vec_test_closed_loop_23,entropy_vec_test_closed_loop_24,entropy_vec_test_closed_loop_25,entropy_vec_test_closed_loop_26,entropy_vec_test_closed_loop_27,entropy_vec_test_closed_loop_28,entropy_vec_test_closed_loop_29,entropy_vec_test_closed_loop_30,
                                  entropy_vec_test_closed_loop_31,entropy_vec_test_closed_loop_32,entropy_vec_test_closed_loop_33,entropy_vec_test_closed_loop_34,entropy_vec_test_closed_loop_35,entropy_vec_test_closed_loop_36,entropy_vec_test_closed_loop_37,entropy_vec_test_closed_loop_38,entropy_vec_test_closed_loop_39,entropy_vec_test_closed_loop_40]

a0_D1_to_beta = [10, 9.5, 0.5]

vec_D_TD_new_closed_loop=[]
# closed-loop: inverse function from beta to D (analitically)
for i in range(len(vec_beta_new_closed_loop)):
    vec_D_TD_new_closed_loop.append(a0_D1_to_beta[2] - 1/a0_D1_to_beta[1]*np.log(a0_D1_to_beta[0]/vec_beta_new_closed_loop[i] - 1))
    
vec_D_TD_new_open_loop=[]
# open-loop: inverse function from beta to D (analitically)
for i in range(len(vec_beta_new_open_loop)):
    vec_D_TD_new_open_loop.append(a0_D1_to_beta[2] - 1/a0_D1_to_beta[1]*np.log(a0_D1_to_beta[0]/vec_beta_new_open_loop[i] - 1))

n_D1 = len(beta_new_closed_loop_1)
D1=np.array(np.linspace(0,1,n_D1))
Q_distr=[0.15,0.30,0.40]

beta= a0_D1_to_beta[0]/(1+np.exp(-(a0_D1_to_beta[1]*(D1 - a0_D1_to_beta[2]))))
beta = np.array(beta)
 
Q_distr = np.array(Q_distr)
n_Q = len(Q_distr)
totQ=np.zeros(n_D1)
P=np.zeros((n_Q,n_D1))
 
for i in range(len(beta)):
    totQ[i] = np.sum(np.exp(beta[i]*Q_distr))
    for j in range(len(Q_distr)):
        P[j,i]=(np.exp(beta[i]*Q_distr[j]))/(totQ[i])
       
print(P)      
 
HP = np.zeros(n_D1)
 
for i in range(n_D1):
    HP[i] = -np.sum(P[:,i]*np.log2(P[:,i]))
 
# normalized theoretical entropy
HP = (HP - min(HP))/(max(HP) - min(HP))
print(HP)

#beta at zero dopamine
beta_D_0= a0_D1_to_beta[0]/(1+np.exp(-(a0_D1_to_beta[1]*(0 - a0_D1_to_beta[2]))))
print('beta_D_0:', beta_D_0)

Q_distr_tilde=Q_distr-np.sum(Q_distr*P[:,0])
k=np.sum(Q_distr_tilde* P[:,0])
 
print('k*  beta_D_0:',k*  beta_D_0)

plt.figure()
plt.plot(D1, HP,'black', linewidth=3)
for i in range(len(vec_D_TD_new_closed_loop)):
    plt.scatter(vec_D_TD_new_closed_loop[i],vec_entropy_vec_test_closed_loop[i],facecolor='lightgray',edgecolor='black', alpha=1)
    plt.scatter(vec_D_TD_new_open_loop[i],vec_entropy_vec_test_open_loop[i],facecolor='lightgray',edgecolor='black', alpha=1)
plt.xlabel('Dopamine*TD',size=17)
plt.ylabel('H(P)',size=17)
plt.xlim(0,1)
plt.axhline(HP[0],xmin=0, xmax=120, linewidth = 2, linestyle ="dotted", color ='silver' )
plt.plot()
plt.show()

#################################################################PARTE_2#################################################################

data_entropy_closed_loop=pd.read_csv('<insert path>',delimiter = ';',decimal=",")
data_entropy_closed_loop.head()

data_entropy_open_loop=pd.read_csv('<insert path>',delimiter = ';',decimal=",")
data_entropy_open_loop.head()

#entropy closed-loop and open-loop
vec_mean_entropy_closed_loop=[np.mean(data_entropy_closed_loop['mean_entropy_Go']), np.mean(data_entropy_closed_loop['mean_entropy_Hold']),np.mean(data_entropy_closed_loop['mean_entropy_Hold_correct']) ]
vec_std_entropy_closed_loop=[np.std(data_entropy_closed_loop['mean_entropy_Go']), np.std(data_entropy_closed_loop['mean_entropy_Hold']),np.std(data_entropy_closed_loop['mean_entropy_Hold_correct']) ]

vec_mean_entropy_open_loop=[np.mean(data_entropy_open_loop['mean_entropy_Go']), np.mean(data_entropy_open_loop['mean_entropy_Hold']),np.mean(data_entropy_open_loop['mean_entropy_Hold_correct']) ]
vec_std_entropy_open_loop=[np.std(data_entropy_open_loop['mean_entropy_Go']), np.std(data_entropy_open_loop['mean_entropy_Hold']),np.std(data_entropy_open_loop['mean_entropy_Hold_correct']) ]

Nent = 3
fig, ax = plt.subplots()
ind = np.arange(Nent)
width = 0.40
ax.bar(ind - width/2 , vec_mean_entropy_open_loop, width, yerr=vec_std_entropy_open_loop,
    align='center', edgecolor='black',color=['#295981','#3d84bf','#8dbdda'], ecolor='black',alpha=0.8, capsize=10,label='open-loop')
ax.bar(ind+width/2 , vec_mean_entropy_closed_loop, width, yerr=vec_std_entropy_closed_loop,
    align='center', color=['#295981','#3d84bf','#8dbdda'],edgecolor='black',ecolor='black',alpha=0.8, capsize=10,  hatch='///', label='closed-loop')
ax.set_ylabel('ENTROPY ',size=17)
plt.xticks(ind, ['Go', 'SS failur', 'SS correct'],size=17)
ax.autoscale_view()
plt.ylim([0,1])
plt.legend()
plt.show()





